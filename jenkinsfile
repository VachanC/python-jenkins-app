pipeline {
    agent {
        docker { image 'python:3.9' }
    }

    environment {
        REPO_URL = 'https://github.com/VachanC/python-jenkins-app.git'
        APP_DIR = 'python-jenkins-app'
    }

    stages {
        stage('Clone Repository') {
            steps {
                sh '''
                    if [ -d "$APP_DIR" ]; then
                        rm -rf $APP_DIR
                    fi
                    git clone $REPO_URL
                '''
            }
        }

        stage('Setup Python Environment') {
            steps {
                sh '''
                    cd $APP_DIR
                    python3 --version
                    python3 -m venv venv
                    source venv/bin/activate
                    pip install -r requirements.txt || echo "No requirements.txt found"
                '''
            }
        }

        stage('Run Python App') {
            steps {
                sh '''
                    cd $APP_DIR
                    source venv/bin/activate
                    python app.py || echo "Ensure app.py exists and runs properly"
                '''
            }
        }
    }

    post {
        success {
            echo "Pipeline completed successfully! ✅"
        }
        failure {
            echo "Pipeline failed. Check logs for errors. ❌"
        }
    }
}
